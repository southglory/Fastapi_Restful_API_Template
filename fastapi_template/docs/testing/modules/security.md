# Security 모듈 테스트 가이드

## 개요

`security` 모듈은 애플리케이션의 보안 관련 기능을 담당합니다. 주로 암호화, 해싱, 키 관리 등의 기능을 제공하며, 다른 보안 관련 모듈(예: auth)의 기반이 됩니다.

## 테스트 용이성

- **난이도**: 쉬움-중간
- **이유**:
  - 대부분 순수 함수이나 일부 외부 라이브러리에 의존
  - 암호화/복호화 기능은 결정적이며 테스트하기 쉬움
  - 키 생성 등 일부 기능은 랜덤성을 포함해 테스트가 복잡할 수 있음

## 테스트 대상

주요 테스트 대상은 다음과 같습니다:

1. **암호화/복호화 기능**
   - 대칭 암호화 (AES 등)
   - 비대칭 암호화 (RSA 등)
   - 암호화 키 관리

2. **해싱 기능**
   - 단방향 해시 함수
   - Salt 사용한 해싱
   - 해시 검증

3. **보안 유틸리티**
   - 안전한 난수 생성
   - 보안 토큰 생성
   - 서명 생성 및 검증

## 테스트 접근법

Security 모듈 테스트 시 다음 접근법을 권장합니다:

1. **단방향 테스트**: 해시 함수는 입력에 대한 출력만 검증합니다.
2. **양방향 테스트**: 암호화/복호화 함수는 원본 데이터 복원이 정확한지 검증합니다.
3. **랜덤 요소 제어**: 테스트에서 랜덤성이 요구되는 부분은 모의 함수를 사용하여 고정된 값을 반환하도록 합니다.

## 구현된 테스트 코드

각 보안 기능별 테스트 코드:

### 암호화/복호화 테스트

- [암호화/복호화 테스트 코드](/fastapi_template/tests/test_security/test_encryption.py)

### 해싱 테스트

- [해싱 테스트 코드](/fastapi_template/tests/test_security/test_hashing.py)

### 보안 토큰 테스트

- [보안 토큰 테스트 코드](/fastapi_template/tests/test_security/test_token.py)

## 테스트 커버리지 확인

Security 모듈은 보안 중요성을 고려하여 높은 테스트 커버리지를 유지해야 합니다:

```bash
pytest --cov=app.common.security tests/test_security/ -v
```

## 모범 사례

1. 다양한 입력값에 대한 테스트를 작성하세요 (정상, 경계, 오류 케이스).
2. 랜덤성이 있는 함수는 모의 함수를 사용하여 결정적으로 만들어 테스트하세요.
3. 암호화 키와 같은 민감한 정보는 테스트용 값을 사용하고, 실제 값을 코드에 포함하지 마세요.
4. 해싱 함수의 경우 다양한 길이와 문자 종류를 포함한 입력으로 테스트하세요.

## 주의사항

1. 실제 키나 비밀정보를 테스트 코드에 하드코딩하지 마세요.
2. 암호화 알고리즘의 보안성을 테스트하는 것이 아니라, 구현의 정확성을 테스트하는 것에 집중하세요.
3. 랜덤성이 있는 함수 테스트 시, 출력값을 정확히 예측하기보다 출력의 특성(길이, 형식 등)을 검증하세요.
4. 성능에 민감한 해싱 함수의 경우, 테스트 실행 시간을 고려하여 반복 횟수를 적절히 조절하세요.
